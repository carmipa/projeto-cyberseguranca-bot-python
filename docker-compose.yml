services:
  cyber-bot:
    build: .
    container_name: cyber-intel-bot
    restart: always
    env_file:
      - .env
    volumes:
      # Dados persistentes (JSONs de estado e histórico)
      - ./data:/app/data
      # Logs do sistema
      - ./logs:/app/logs
      # Configuração (opcional - será criado automaticamente se não existir)
      # O bot usa load_json_safe que retorna {} se o arquivo não existir
    networks:
      - cyber-network
    # Limites de recursos para bot de varredura
    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 256M

  nodered:
    image: nodered/node-red:latest
    container_name: cyber-nodered
    restart: always
    user: "root"
    environment:
      - NODE_RED_ENABLE_PROJECTS=false
      - NODE_RED_ENABLE_SAFE_MODE=false
      - FLOWS=flows.json
    ports:
      - "1880:1880"
    volumes:
      - ./node-red-data:/data
    command: >
      bash -c "npm install --prefix /data --no-audit --no-update-notifier node-red-dashboard && /usr/src/node-red/entrypoint.sh"
    networks:
      - cyber-network

networks:
  cyber-network:
    driver: bridge
